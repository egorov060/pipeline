pipeline {
    agent {
    docker {
        image '192.168.55.22:8123/jenkins-maven'
        args '-u root -v /var/run/docker.sock:/var/run/docker.sock'
    }
}
stages {
    stage ('Copy source') {
        steps {
            git 'https://github.com/egorov060/origin555.git'
        }
    }
    stage ('build war') {
        steps {
            sh 'mvn package'
        }
    }
    stage ('Make docker image') {
        steps {
         //   sh 'groupadd docker'
         //   sh 'chown root:docker /var/run/docker.sock'
         //   sh 'docker login 192.168.55.22:8123 --username admin --password Q1w2e3r4'
            sh 'docker build -t myweb:latest .' 
            sh 'docker login 192.168.55.22:8123 --username admin --password Q1w2e3r4 && docker tag myweb:latest 192.168.55.22:8123/myweb:latest && docker push 192.168.55.22:8123/myweb:latest'
        }
    }
}
}